const help={JsonFromLink(t){if(t&&t.url)try{return JSON.parse(`{${t.url}}`)}catch(e){}return!1},getCharInfo(...t){let e,o,i,a,r=null;if("function"==typeof t[t.length-1]&&(r=t.pop()),1===t.length&&Array.isArray(t[0])&&2===t[0].length){let[l,n]=t[0];l=Math.floor(l),n=Math.floor(n);let s=help.pixelToCell([l,n]);[e,o,i,a]=s}else if(1===t.length&&Array.isArray(t[0])&&4===t[0].length)[e,o,i,a]=t[0];else if(1===t.length&&"object"==typeof t[0]){let h=t[0];if("tileX"in h&&(e=h.tileX),"tileY"in h&&(o=h.tileY),"charX"in h&&(i=h.charX),"charY"in h&&(a=h.charY),"x"in h&&"y"in h){let c=help.pixelToCell([Math.round(h.x),Math.round(h.y)]);[e,o,i,a]=c}}else{if(!cursorCoords)return null;[e,o,i,a]=cursorCoords}let p=getChar(e,o,i,a),u=getCharColor(e,o,i,a),d=getCharProtection(e,o,i,a),f=["public","member","owner"],y=getLink(e,o,i,a),g=help.JsonFromLink(y),m=null;return r&&(m=r(p)),{loaded:isTileLoaded(e,o),char:p,color:u,bgColor:getCharBgColor(e,o,i,a),protection:d,decoration:getCharDecoration(e,o,i,a),link:y,json:g,empty:(0==p.trim().length||[6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8203,8204,8205,8239,8287,8288,12288,10240,12644,65279,,32].includes(p.charCodeAt())||u===resolveColorValue(styles[f[d]]))&&!y,custom:m}},coordinateAdd(...t){let e,o,i,a,r,l,n,s;if(t[0]instanceof Array&&5===t.length)[e,o,i,a]=t[0],[r,l,n,s]=t.slice(1);else if(t[4]instanceof Array&&5===t.length)[e,o,i,a]=t,[r,l,n,s]=t[4];else if(8===t.length)[e,o,i,a,r,l,n,s]=t;else if(2===t.length&&t[0]instanceof Array&&t[1]instanceof Array)[e,o,i,a]=t[0],[r,l,n,s]=t[1];else{if(1!==t.length||!(t[0]instanceof Array))return null;8==t[0].length&&([e,o,i,a,r,l,n,s]=t[0])}return[e+r+Math.floor((i+n)/tileC),o+l+Math.floor((a+s)/tileR),i+n-Math.floor((i+n)/tileC)*tileC,a+s-Math.floor((a+s)/tileR)*tileR]},pixelToCell(...t){let e,o;if(2===t.length)[e,o]=t;else if(1===t.length&&Array.isArray(t[0])&&2===t[0].length)[e,o]=t[0];else if(1===t.length&&"object"==typeof t[0])"x"in t[0]&&(e=t[0].x),"y"in t[0]&&(o=t[0].y);else throw Error("Invalid input format. Use either (x, y), [x, y], or an object with x and y properties.");e=Math.round(e),o=Math.round(o);var i=0,a=0,r=0,l=0,n=e-positionX-Math.trunc(owotWidth/2),s=o-positionY-Math.trunc(owotHeight/2);return r=Math.floor(n/cellW),l=Math.floor(s/cellH),i=Math.floor(r/tileC),a=Math.floor(l/tileR),r-=Math.floor(r/tileC)*tileC,l-=Math.floor(l/tileR)*tileR,[i,a,r,l]},cellToPixel(...t){let e,o,i,a;if(Array.isArray(t[0])?[e=0,o=0,i=0,a=0]=t[0]:"object"==typeof t[0]?("tileX"in t[0]&&(e=t[0].tileX),"tileY"in t[0]&&(o=t[0].tileY),"charX"in t[0]&&(i=t[0].charX),"charY"in t[0]&&(a=t[0].charY)):[e=0,o=0,i=0,a=0]=t,t.length>4||void 0===e||void 0===o||void 0===i||void 0===a){console.error(`CellToPixelCoords: Invalid cellCoords. Arguments can either be ([x, y, z, w]) or (x,y,z,w) or an object with tileX, tileY, charX, charY. Your cellCoords was: ${t}`);return}let r=Math.round(e)*tileW+i*cellW+Math.round(positionX)+Math.round(owotWidth/2),l=Math.round(o)*tileH+a*cellH+Math.round(positionY)+Math.round(owotHeight/2);return[r,l]},lerp(t=0,e=0,o=.5,i=!1){if("object"==typeof t&&"object"==typeof e){if(Array.isArray(t))return t.map((t,a)=>help.lerp(t,e[a],o,i));let a={};for(let r in t)e.hasOwnProperty(r)&&(a[r]=help.lerp(t[r],e[r],o,i));return a}if(Array.isArray(t)){if("number"==typeof e)return t.map(t=>help.lerp(t,e,o,i));if(Array.isArray(e)){if(1===e.length)return t.map(t=>help.lerp(t,e[0],o,i));if(t.length===e.length)return t.map((t,a)=>help.lerp(t,e[a],o,i))}}let l=(1-o)*t+o*e;if(!1!==i){if("number"==typeof i){let n=1/i;l=Math.round(l*n)/n}else l=Math.round(l)}return l},resetChat(){for(;page_chatfield.firstChild;)page_chatfield.firstChild.remove();network.chathistory()},subtract(t=[0],e=0,o=!1){if(Array.isArray(t)){if(Array.isArray(e)){if(t.length===e.length){let i=t.map((t,i)=>{let a=t-e[i];return o&&(a=Math.round(a)),a});return i}}else if("number"==typeof e){let a=t.map(t=>{let i=t-e;return o&&(i=Math.round(i)),i});return a}}else if("object"==typeof t&&"object"==typeof e){let r={};for(let l in t)e.hasOwnProperty(l)&&(r[l]=t[l]-e[l],o&&(r[l]=Math.round(r[l])));return r}},add(t=[0],e=0,o=!1){if(Array.isArray(t)){if(Array.isArray(e)){if(t.length===e.length){let i=t.map((t,i)=>{let a=t+e[i];return o&&(a=Math.round(a)),a});return i}}else if("number"==typeof e){let a=t.map(t=>{let i=t+e;return o&&(i=Math.round(i)),i});return a}}else if("object"==typeof t&&"object"==typeof e){let r={};for(let l in t)e.hasOwnProperty(l)&&(r[l]=t[l]+e[l],o&&(r[l]=Math.round(r[l])));return r}},correctLocation(...t){let e=null;if(Array.isArray(t[0]))e=t[0];else if(t[0]instanceof Object){let{tileX:o=0,tileY:i=0,charX:a=0,charY:r=0}=t[0];e=[o,i,a,r]}else e=t;let l=e.map(t=>Math.round(t)),n=[...l];return l[2]>15&&(n[2]=(l[2]%16+(l[2]<0?17:0)+16)%16,n[0]+=Math.abs(Math.ceil(-l[2]/16))),l[2]<0&&(n[2]=(l[2]%16+(l[2]<0?17:0)-1+16)%16,n[0]-=Math.ceil(-l[2]/16)),l[3]>7&&(n[3]=(l[3]%8+(l[3]<0?9:0)+8)%8,n[1]+=Math.abs(Math.ceil(-l[3]/8))),l[3]<0&&(n[3]=(l[3]%8+(l[3]<0?9:0)-1+8)%8,n[1]-=Math.ceil(-l[3]/8)),n},getDistance(t,e,o=!1,i=!1){let a,r,l,n;if(Array.isArray(t)&&Array.isArray(e))[a,r]=t,[l,n]=e;else if("object"==typeof t&&"object"==typeof e&&"x"in t&&"y"in t&&"x"in e&&"y"in e)a=t.x,r=t.y,l=e.x,n=e.y;else throw Error("Invalid arguments");i&&(a/=cellW,r/=cellH,l/=cellW,n/=cellH);let s=l-a,h=n-r,c=Math.sqrt(s*s+h*h);return o?[s,h]:c},AreArraysEqual(t,e){if(!t||!e||t.length!==e.length)return!1;for(let o=0;o<t.length;o++)if(t[o]!==e[o])return!1;return!0},stringToJson(t){let e=!1;try{e=JSON.parse(t)}catch(o){return!1}return e},clearLocalWrites(){for(var t in tiles){var e=getPos(t);e[1],e[0];var o=tiles[t];o&&(o.stale=!0)}},localwriteCharTo(t,e,o,i,a,r,l=-1,n=!1,s=!1,h=!1,c=!1){Tile.get(o,i)||Tile.set(o,i,blankTile());var p,u,d,f,y,g=Tile.get(o,i),m="\b"==t;m&&(t=" ",e=0,l=-1),null==l&&(l=-1);var b=g.properties.cell_props;b||(b={});var $=g.properties.color,_=g.properties.bgcolor;$||($=Array(tileArea).fill(0));var v=!1,x=0,C=-1,A="";getLink(o,i,a,r),b[r]&&b[r][a]&&(delete b[r][a],v=!0),x=$[r*tileC+a],$[r*tileC+a]=e,x!=e&&(v=!0),g.properties.color=$,_||-1==l||(_=Array(tileArea).fill(-1),g.properties.bgcolor=_),_&&(C=_[r*tileC+a],_[r*tileC+a]=l,C!=l&&(v=!0)),g.properties.cell_props=b,m||(y=getCharTextDecorations(t),t=clearCharTextDecorations(t),t=detectCharEmojiCombinations(t)||t,p=textDecorationModes.bold,u=textDecorationModes.italic,d=textDecorationModes.under,f=textDecorationModes.strike,y&&(p=p||y.bold,u=u||y.italic,d=d||y.under,f=f||y.strike)," "==t&&(p=!1,u=!1),null!=n&&(p=!!n),null!=s&&(u=!!s),null!=h&&(d=!!h),null!=c&&(f=!!c),t=setCharTextDecorations(t,p,u,d,f));var T=g.content;return A=T[r*tileC+a],T[r*tileC+a]=t,A!=t&&(v=!0),w.setTileRedraw(o,i,!0),bufferLargeChars&&(0==r&&w.setTileRedraw(o,i-1,!0),a==tileC-1&&w.setTileRedraw(o+1,i,!0),0==r&&a==tileC-1&&w.setTileRedraw(o+1,i-1,!0)),v},broadcast:{channel:"default",cast:!1,data:[],loopData:function(){for(let t in help.broadcast.data)if(Object.hasOwnProperty.call(help.broadcast.data,t)){if(help.broadcast.data[t]["character-pixel-location"]){let e=help.broadcast.data[t]["character-pixel-location"];if(e.data){let[o,i]=e.data,[a,r]=help.cellToPixel(i);playerLayer.drawTextCharacter(o,a,r,"blue")}}if(help.broadcast.data[t]["local-write"]){let l=help.broadcast.data[t]["local-write"];if(l.data){let[n,s,h,c,p,u]=l.data;for(let d of l.data){let[f,y,g,m,b,$]=d;help.localwriteCharTo(f,y,g,m,b,$)}}}}},recieve(t){w.broadcastReceive(t),w.on("cmd",function(t){if(t.sender&&w.socketChannel!==t.sender){let e=help.stringToJson(t.data);if(e&&e.broadcast&&e.broadcast[help.broadcast.channel]&&e.broadcast[help.broadcast.channel].Bname){let o=help.broadcast.channel,i=e.broadcast[o];if(i){let{Bdata:a,Bname:r,Btype:l}=i;help.broadcast.updateData(r,l,a)}else console.log(`No data found for channel: ${o}`)}}})},dataClearTimer:1e3,updateData(t,e,o){help.broadcast.data[t]||(help.broadcast.data[t]={}),help.broadcast.data[t][e]||(help.broadcast.data[t][e]={data:null,timer:null}),help.broadcast.data[t][e].data=o,clearTimeout(help.broadcast.data[t][e].timer),help.broadcast.data[t][e].timer=setTimeout(()=>{help.broadcast.data[t][e].data=null,console.log(`Data for ${t}/${e} has been set to null after ${.001*help.broadcast.dataClearTimer} second(s) of inactivity.`)},help.broadcast.dataClearTimer)}},getLinePositions(t,e,o){let i="Start and End arguments can either be pixel-based [x,y] or they can be cell-based [tileX, tileY, charX, charY] arrays, or objects{x,y} or objects{tileX, tileY, charX, charY} type help.getLinePositions.info() for more information";function a(t){return"object"==typeof t&&"x"in t&&"y"in t?[t.x,t.y]:null}function r(t){return"object"==typeof t&&"tileX"in t&&"tileY"in t&&"charX"in t&&"charY"in t?[t.tileX,t.tileY,t.charX,t.charY]:null}let l=a(t)||r(t)||t,n=a(e)||r(e)||e;if(!Array.isArray(l)||!Array.isArray(n))throw Error(i);let s,h;if(2===l.length)s=l.slice();else if(4===l.length)s=help.cellToPixel(l);else throw Error(i);if(2===n.length)h=n.slice();else if(4===n.length)h=help.cellToPixel(n);else throw Error(i);let c=help.getDistance(s,h,!1,!0),p=[];if(0!==c){let u=1/c,d=null;for(let f=0;f<1;f+=u){let y=help.pixelToCell(help.lerp(s,h,f,!0));if(!help.AreArraysEqual(d,y)){let[g,m,b,$]=y;d=y,o(g,m,b,$),p.push(y)}}}return p},getSquarePositions(...t){let e,o=0,i=1,a=!1,r=!1,l=null;function n(t,e,o){t&&highlight([e],!0,int_to_rgb(o))}function s(t,e,o){return help.coordinateAdd(t,[0,0,-1*(e+o),-1*(e+o)])}function h(){return{top:{left:[],center:[],right:[]},bottom:{left:[],center:[],right:[]},left:[],right:[],center:[]}}function c(t,e,o,i,a){let r={topLeft:255,bottomLeft:754674,trueLeft:7542674,topRight:23463,bottomRight:2343463,trueRight:23434463,topCenter:53434463,bottomCenter:939434463,innerSquare:93943},l=e,n=t,s=l<a,h=l>=o-a,c=n<a,p=n>=o-a,u,d,f;s?c?(u=r.topLeft,f="topLeft"):p?(u=r.bottomLeft,f="bottomLeft"):(u=r.trueLeft,f="trueLeft"):h?c?(u=r.topRight,f="topRight"):p?(u=r.bottomRight,f="bottomRight"):(u=r.trueRight,f="trueRight"):c?(u=r.topCenter,f="topCenter"):p?(u=r.bottomCenter,f="bottomCenter"):(u=r.innerSquare,f="innerSquare"),d=help.coordinateAdd(i,[0,0,l,n]);let[y,g,m,b]=d;return{color:u,position:d,type:f}}function p(t,e,o){255===e?t.top.left.push(o):754674===e?t.bottom.left.push(o):7542674===e?t.left.push(o):23463===e?t.top.right.push(o):2343463===e?t.bottom.right.push(o):23434463===e?t.right.push(o):53434463===e?t.top.center.push(o):939434463===e?t.bottom.center.push(o):t.center.push(o)}t.length>=1&&(e=t[0]),t.length>=2&&("number"==typeof t[1]?o=t[1]:"function"==typeof t[1]?l=t[1]:"boolean"==typeof t[1]?(a=t[1],r=t[1]):i=t[1]),t.length>=3&&("number"==typeof t[2]?"number"==typeof t[1]?i=t[2]:o=t[2]:"boolean"==typeof t[2]?r=t[2]:l=t[2]),t.length>=4&&(r=t[3]),t.length>=5&&(l=t[4]),2==e.length&&(e=help.pixelToCell(e));let u=(o+i)*2+1,d=s(e,o,i),f=h();for(let y=0;y<u;y++)for(let g=0;g<u;g++){let{color:m,position:b,type:$}=c(y,g,u,d,i);"function"==typeof l&&l($,b),n(r,b,m),p(f,m,b)}return f},getMouseData(){let[t,e]=currentMousePosition,o=help.pixelToCell(t,e),i={pos:{screen:[t,e],cell:o},charInfo:help.getCharInfo(o)};return i},username:w.clientId,throttle(t,e){let o=0;return function(...i){let a=Date.now();a-o>=e&&(t.apply(this,i),o=a)}},updateName:()=>OWOT.events.chat?(fn=function(...t){let e=t.find(t=>"object"==typeof t&&t.type);e?e&&/^T\w+( \w+)*\.$/.test(e.message)&&!e.date&&(name="anon_nick"===e.type?(fn,`${e.nickname}_${e.id}`):(fn,e.nickname||e.realUsername||e.id||w.clientId)):(OWOT.events.chat.push(fn),api_chat_send("/test"))})(fn):w.clientId,AutoUpdateName(){w.on("frame",help.throttle(help.updateName,1e3))},UIButton:class{constructor(t,e,o){this.text=t,this.position=e,this.callback=o,this.buttonElement=document.createElement("button"),this.buttonElement.textContent=this.text,this.buttonElement.style.position="absolute",this.buttonElement.style.left=`${this.position.x}px`,this.buttonElement.style.top=`${this.position.y}px`,this.buttonElement.style.padding="10px 20px",this.buttonElement.style.backgroundColor="#007bff",this.buttonElement.style.color="#fff",this.buttonElement.style.border="none",this.buttonElement.style.borderRadius="5px",this.buttonElement.style.cursor="pointer",this.buttonElement.addEventListener("mouseover",()=>{this.buttonElement.style.backgroundColor="#0056b3"}),this.buttonElement.addEventListener("mouseout",()=>{this.buttonElement.style.backgroundColor="#007bff"}),this.buttonElement.addEventListener("click",()=>{"function"==typeof this.callback&&this.callback()}),document.body.appendChild(this.buttonElement)}setText(t){this.text=t,this.buttonElement.textContent=this.text}setPosition(t){this.position=t,this.buttonElement.style.left=`${this.position.x}px`,this.buttonElement.style.top=`${this.position.y}px`}setCallback(t){this.callback=t}},automation:{Step:class{constructor(t,e,o){this.callback=t,this.sequencer=e,this.conditional="function"==typeof o?o:()=>!0}async execute(){for(;this.sequencer.step!==this.stepNumber||!this.conditional();)await new Promise(t=>setTimeout(t,0));await new Promise(t=>setTimeout(t,0)),this.callback()}setStepNumber(t){this.stepNumber=t}},Sequencer:class{constructor(t){this.step=0,this.currentStepNumber=0,this.steps=[],this.name=t,this.data={}}createStep(t,e){let o=new help.automation.Step(t,this,e);return o.setStepNumber(this.currentStepNumber),this.currentStepNumber++,this.steps.push(o),o}async sequenceLoop(){for(;;)for(let t of this.steps)await t.execute()}stepUp(){this.step++,this.step>=this.steps.length&&(this.step=0)}stepDown(){this.step>0?this.step--:this.step=this.steps.length-1}}},KeybindingManager:class{constructor(t){this.eventKeybindings=new Map,this.handleKeyPress=this.handleKeyPress.bind(this),t.addEventListener("keydown",this.handleKeyPress),t.addEventListener("keyup",this.handleKeyPress)}addKeybinding(t,e,o){this.eventKeybindings.has(t)||this.eventKeybindings.set(t,[]),this.eventKeybindings.get(t).push({key:e,callback:o})}removeKeybinding(t,e){let o=this.eventKeybindings.get(t);if(o){let i=o.findIndex(t=>t.key===e);-1!==i&&(o.splice(i,1),0===o.length&&this.eventKeybindings.delete(t))}}handleKeyPress(t){let e=t.key;for(let[o,i]of this.eventKeybindings){let a=i.find(t=>t.key===e);a&&(a.callback(t),t.preventDefault())}}listKeybindings(){return Array.from(this.eventKeybindings.entries()).map(([t,e])=>({event:t,key:e.map(t=>t.key)}))}},build(){var chatLoop,oldChat=eval(`(${addChat.toString()})`);chatLoop=setTimeout(function(){oldChat?addChat=function(t,e,o,i,a,r,l,n,s,h,c,p,u=!0){!1==/This message is visible to only you/.test(a)&&u&&oldChat(t,e,o,i,a,r,l,n,s,h,c,p,!1)}:chatLoop()},100),help.updateName(),help.getCharInfo.info=function(){console.warn(`help.getCharInfo:
This function is used to get infomation about a cell's: char, colors, decorations, protection, and if it appears empty.

The following examples are considered valid inputs: 
(a,b,c,d)
(array[4])
an object containing tileX, tileY, charX, charY keys.

Example usage: help.getCharInfo(cursorCoords) this will get cell data of your current cursor.
This would be useful when trying to determine if a cell is protected, and what kind of data is in the cell in case we wanna do collision detection of a game or store a cells value for use later.
`)},help.coordinateAdd.info=function(){console.warn(`help.coordinateAdd:
This function is used to add two cell coordinates together.

The following examples are considered valid inputs: 
(a,b,c,d,e,f,g,h)
(array[4], e,f,g,h)
(a,b,c,d,array[4])
(array[4], array[4])
(array[8])

Example usage: help.coordinateAdd(cursorCoords,[0,0,0,1]) this will get the coords 1 to the right of your cursor coordinate.
This would be useful to get a cell that is nearby another.
`)},help.pixelToCell.info=function(){console.warn(`help.pixelToCell:
This function is used to a convert pixel coordinate [x,y] to a cell coordinate [tileX, tileY, charX, charY].

The following examples are considered valid inputs: 
(x,y)
(array[2])
an object containing x, y keys such as a click event object.

Example usage: function (e) { help.pixelToCell(e) this will get the coords from the event x,y pixel location.
This would be useful when trying to get a pixel coord from a mouse or perhaps from a pixel-based character on another canvas, and translating it to the nearest cell on the owot canvas.
`)},help.cellToPixel.info=function(){console.warn(`help.cellToPixel:
This function is used to a convert cell coordinate [tileX, tileY, charX, charY] to a pixel coordinate [x,y].

The following examples are considered valid inputs: 
(x,y,z,w)
(array[4])
an object containing tileX, tileY, charX, charY keys.

Example usage: help.cellToPixel([5,5,4,4]) this will return a pixel [x,y] location.
This would be useful when trying translate cell coords to pixel coords.
`)},help.lerp.info=function(){console.warn(`help.lerp:
This function is used to blend numbers together. (start, end, amt = 0.5, roundResult = false)

The following examples are considered valid inputs: (amt and roundResult are optional): 
(a,b)
(array[N] , b)
(array[N],array[N])
(object,object)

Example usage: help.lerp([0, 100], [100, 200], 0.5)); this Outputs: [50, 150].
This would be useful when trying get coords along a linear path, or having a smooth change in a character's speed; slowly increasing or decreasing. 
Feature: roundResult can be set to false to not round, true to round to the nearest integer, or you can set a specific number to round to for example help.lerp(10,2,0.1,0.25) = 9.25 instead of 9 or 9.2.
`)},help.subtract.info=function(){console.warn(`help.subtract:
This function is used to substract two variables from eachother. It can be arrays, numbers and objects.

The following examples are considered valid inputs: 
(array , array)
(array , number)
(object, object)

Example usage:  help.subtract([10,10,5,5],1), the output would be [9,9,4,4] 
`)},help.add.info=function(){console.warn(`help.add:
This function is used to add two variables together. It can be arrays, numbers and objects.

The following examples are considered valid inputs: 
(array , array)
(array , number)
(object, object)

Example usage: help.add([10,10,5,5],1), the output would be [11,11,6,6] 
`)},help.correctLocation.info=function(){console.warn(`help.correctLocation:
This function is used to convert an invalid cell location into a valid one.

The following examples are considered valid inputs: (amt and roundResult are optional): 
(a,b,c,d)
([a,b,c,d])
an object containing tileX, tileY, charX, charY keys.

Example usage: help.correctLocation(10,10,5,100) x is 100 which is invalid so the tileX value is shifted. This outputs: [10, 22, 5, 4]
This would be useful when moving a character left or right, or over large distances, just update the cellX or cellY and this will correct any issues for you.
`)},help.getDistance.info=function(){console.warn(`help.getDistance:
This function is used to return the distance between two [x,y] or {x,y} points either in pixel space or in owot cell space.
The following examples are considered valid inputs: (separate, cellUnit, are both optional): ([x,y]) || ({x,y})
Example usage: help.getDistance([10,0],[0,0],true,true) this will return [-1, 0] since seperate == true and we are converting to cell coords
This would be useful for checking the distance between two 2d coords.
`)},help.AreArraysEqual.info=function(){console.warn(`help.AreArraysEqual:
This function returns true if two arrays are the same.
The following examples are considered valid inputs: (array,array)
Example usage: help.AreArraysEqual([10,0],[0,0]) this will return false
This would be useful for checking two arrays against eachother, like when looping through pixels and converting to cell coords, if you only want to return cellcoords when they are not the same as the one before it.
`)},help.getLinePositions.info=function(){console.warn(`help.getLinePositions:
This  function has a looped callback of (tileX, tileY, charX, charY). it will also return an array at the end of the function call.

The following examples are considered valid inputs: 
array[tileX, tileY, charX, charY]
array[x,y]
object{x,y}
object{tileX, tileY, charX, charY}

Example usage: help.getLinePositions(startCoords, endCoords,function(a, b, c, d){console.log(a, b, c, d)}) this will run a callback and log all the coords.
This would be useful for getting points in a line between two points. The callback data can be used for building line drawers.
`)},help.getSquarePositions.info=function(){console.warn(`help.getSquarePositions:
This  function has a looped callback of type, position(tileX, tileY, charX, charY). it will also return an object at the end of the function call.

The following examples are considered valid inputs: 
getSquarePositions(centerPosition);
getSquarePositions(centerPosition);
getSquarePositions(centerPosition, cellBuffer);
getSquarePositions(centerPosition, callback);
getSquarePositions(centerPosition, distanceFromCenter);
getSquarePositions(centerPosition, cellBuffer, debug);
getSquarePositions(centerPosition, distanceFromCenter, callback);
getSquarePositions(centerPosition, cellBuffer, debug, callback);

Example usage: help.getSquarePositions(cursorCoords,true,function(color,position){console.log(color,position)}). This function will console log each positin and color, it will also highlight the square.
This will be usefull for drawing squares, or using this with a character for collision detection or serrounding cells.
`)},help.getMouseData.info=function(){console.warn(`help.getMouseData:
This  function returns the mouse location in pixel-space and cell-space. It also gets the character data under the mouse position.
`)},help.throttle.info=function(){console.warn(`help.throttle:
This  function is used to rate-limit a function. 
Example usage: help.throttle(myFunction,1000); myFunction(){console.log(hello);}

`)},help.build=null}};help.build();const platformer={data:{players:[],layers:[],playerReps:{},frame:0},settings:{gravity:[0,8],slowdown:.05,debug:!1,collideWithCanvas:!0,pixelcollision:!1,autoCenterPlayer:!0},controls:new help.KeybindingManager(elm.textInput),CharAttributes:class{constructor(){this.attributes={breakable:"",harmfulFromSides:"",harmfulFromTop:"",harmfulFromBottom:"",jumpthrough:"^\uD83E\uDC05",fallthough:"v\uD83E\uDC07",leftthough:"<◢◤\uD83E\uDC04",rightthough:">◥◣\uD83E\uDC06",though_updown:"|",though_leftright:"-",autoLeft:"◢◤\uD83E\uDC04",autoRight:"◥◣\uD83E\uDC06",autoUp:"^\uD83E\uDC05",autoDown:"v\uD83E\uDC07",climb:"\uD833\uDC84",ignore:"\uD833\uDC84•"}}addChar(t,e){this.attributes.hasOwnProperty(t)&&(this.attributes[t]+=e)}removeChar(t,e){this.attributes.hasOwnProperty(t)&&(this.attributes[t]=this.attributes[t].replace(e,""))}get(t){return this.attributes.hasOwnProperty(t)?this.attributes[t]:null}is(t,e){return!!this.attributes.hasOwnProperty(t)&&this.attributes[t].includes(e)}findKeysForCharacter(t){let e=[];for(let o in this.attributes)this.attributes.hasOwnProperty(o)&&this.attributes[o].includes(t)&&e.push(o);return e.length>0?e:null}},centerPlayer(t){let[e,o]=t;return e+=positionX,o+=positionY,platformer.scrollWorld(help.lerp([0,0],help.subtract([e,o],[owotWidth/2,owotHeight/2]),.01))},scrollWorld(t=[0,0]){let[e,o]=t,i=e,a=o;return positionY-=a,positionX-=i,w.emit("scroll",{deltaX:-i,deltaY:-a}),[a,i]},ReadFrequently(){let t=owot.cloneNode();owot.replaceWith(t),owot=t,elm.owot=t,owotCtx=owot.getContext("2d",{willReadFrequently:!0}),w.redraw()},getCanvasArea(t,e,o,i,a){let r=t.getImageData(e,o,i,a),l=r.data;return{data:l,x:e,y:o,width:i,height:a}},getCanvasAreaData(t,e,o,i){let a={empty:null,info:null,type:null},[r,l]=t.location;"top"==o&&(l-=cellH/2),"left"==o&&(r-=cellW/2),"right"==o&&(r+=cellW/4);let{u:n,x:s,y:h}=e;s+=r+positionX,h+=l+positionY;let{data:c,width:p,height:u}=e.data,[d,f]=[s,h];for(let y=0;y<c.length;y+=4){c[y],c[y+1],c[y+2];let g=c[y+3];if(d>p+s&&(f++,d=s-1),d++,0!==g){let m=help.pixelToCell([d,f]);(platformer.settings.debug||i)&&highlight([m],!0,int_to_rgb(8127634*Math.random()));let b=help.getCharInfo(m),$=t.charAttributes.findKeysForCharacter(b.char);return a.empty=b.empty,a.info=b,a.type=$,a}}return a.empty=!0,a},getSectionData(t,e,o,i,a){let r=new ImageData(i,a);for(let l=0;l<a;l++)for(let n=0;n<i;n++){let s=((o+l)*t.width+(e+n))*4,h=(l*i+n)*4;r.data[h]=t.data[s],r.data[h+1]=t.data[s+1],r.data[h+2]=t.data[s+2],r.data[h+3]=t.data[s+3]}return{data:r,x:e,y:o}},Player:class{constructor(t=[-1*positionX+owotWidth/2,-1*positionY+owotHeight/2]){this.location=t,this.destination=this.location,this.snapLocation=this.location,this.velocity={x:0,y:0,max:1},this.charAttributes=new platformer.CharAttributes,this.playerAttributes={},this.jumpFrames=0,this.maxJumpFrames=10,this.actions={},this.onCreate()}test(t){console.log("test",t)}onCreate(){platformer.scrollWorld(help.lerp([0,0],help.subtract(this.location,[owotWidth/2,owotHeight/2]),1)),platformer.data.players.push(this),platformer.controls.addKeybinding("moveUp","w",t=>{this.actions.moveUp="keydown"==t.type}),platformer.controls.addKeybinding("moveLeft","a",t=>{this.actions.moveLeft="keydown"==t.type}),platformer.controls.addKeybinding("moveDown","s",t=>{this.actions.moveDown="keydown"==t.type}),platformer.controls.addKeybinding("moveRight","d",t=>{this.actions.moveRight="keydown"==t.type}),platformer.controls.addKeybinding("attack","space",t=>{this.actions.attack="keydown"==t.type})}broadcast(){let t=this,[e,o]=t.location,[i,a,r,l]=help.pixelToCell(e+positionX,o+positionY),[n,s]=help.getDistance(help.cellToPixel([0,0]),t.location,!0),h={Btype:"character-pixel-location",Bdata:[t.currentRep,[i,a,r,l]],Bname:name};w.broadcastCommand(`{"broadcast": {"${help.broadcast.channel}":${JSON.stringify(h)}}}`,!0)}update(){let[t,e]=platformer.settings.gravity;this.playerAttributes.canMoveUp&&this.actions.moveUp&&(e>=0&&this.jumpFrames<this.maxJumpFrames||e<=0)&&(this.setDestination("up"),this.jumpFrames++),this.playerAttributes.canMoveLeft&&this.actions.moveLeft&&(t>0&&this.jumpFrames<this.maxJumpFrames||t<=0)&&(this.setDestination("left"),this.jumpFrames++),this.playerAttributes.canMoveDown&&this.actions.moveDown&&(e<0&&this.jumpFrames<this.maxJumpFrames||e>=0)&&(this.setDestination("down"),this.jumpFrames++),this.playerAttributes.canMoveRight&&this.actions.moveRight&&(t<0&&this.jumpFrames<this.maxJumpFrames||t>=0)&&this.setDestination("right"),this.playerAttributes.canMoveUp&&this.actions.autoUp&&this.setDestination("auto-up"),this.playerAttributes.canMoveLeft&&this.actions.autoLeft&&this.setDestination("auto-left"),this.playerAttributes.canMoveDown&&this.actions.autoDown&&this.setDestination("auto-down"),this.playerAttributes.canMoveRight&&this.actions.autoRight&&this.setDestination("auto-right"),(this.playerAttributes.canMoveRight||this.playerAttributes.canMoveLeft)&&this.setDestination("float-x"),(this.playerAttributes.canMoveDown||this.playerAttributes.canMoveUp)&&this.setDestination("float-y"),this.climbing?(this.velocity.x=help.lerp(this.velocity.x,0,1),this.velocity.y=help.lerp(this.velocity.y,0,1),this.jumpFrames=0):(this.velocity.x=help.lerp(this.velocity.x,t,platformer.settings.slowdown),this.velocity.y=help.lerp(this.velocity.y,e,platformer.settings.slowdown)),!1==this.playerAttributes.canMoveUp&&(this.velocity.y<0&&(this.velocity.y=0),e<0&&(this.jumpFrames=0)),!1==this.playerAttributes.canMoveDown&&(this.velocity.y>0&&(this.velocity.y=0),e>0&&(this.jumpFrames=0)),!1==this.playerAttributes.canMoveLeft&&(this.velocity.x<0&&(this.velocity.x=0),t<0&&(this.jumpFrames=0)),!1==this.playerAttributes.canMoveRight&&(this.velocity.x>0&&(this.velocity.x=0),t>0&&(this.jumpFrames=0));let o=this;!function(){let[t,e]=help.getDistance(o.location,o.destination,!0,!0),[i,a]=o.location,[r,l]=o.destination,n=Math.abs(r-i)>=cellW,s=Math.abs(l-a)>=cellH;o.location=[n?r>i?i+cellW:i-cellW:r,s?l>a?a+cellH:a-cellH:l]}(),o.snapLocation=help.cellToPixel(help.pixelToCell(o.location)),this.determineCellRep(),this.broadcast()}setDestination(t){let[e,o]=this.destination,[i,a]=platformer.settings.gravity;"up"==t&&(this.velocity.y-=cellW/3),"down"==t&&(this.velocity.y+=cellW/3),"left"==t&&(this.velocity.x-=cellW/3),"right"==t&&(this.velocity.x+=cellW/3),"auto-up"==t&&(this.velocity.y-=.01*cellW+a/10),"auto-down"==t&&(this.velocity.y+=.01*cellW),"auto-left"==t&&(this.velocity.x-=.01*cellW),"auto-right"==t&&(this.velocity.x+=.01*cellW),"float-x"==t&&(e+=this.velocity.x),"float-y"==t&&(o+=this.velocity.y),this.velocity.x>cellW/2&&(this.velocity.x=cellW/2),this.velocity.x<-(cellW/2)&&(this.velocity.x=-(cellW/2)),this.velocity.y>cellH/2&&(this.velocity.y=cellH/2),this.velocity.y<-(cellW/2)&&(this.velocity.y=-(cellW/2)),this.destination=[e,o]}render(){let t=this;platformer.settings.autoCenterPlayer&&platformer.centerPlayer(this.location),w.redraw(),help.broadcast.loopData(),function(){let[e,o]=t.location,[i,a,r,l]=help.pixelToCell(e+positionX,o+positionY);t.layer.drawTextCharacter(t.currentRep,e+positionX,o+positionY,"red")}()}cycleRep(t){let e=t.length;return t[platformer.data.frame%e]}determineCellRep(){let[t,e]=platformer.settings.gravity,{x:o,y:i}=this.velocity||[0,0];Math.abs(t)>Math.abs(e)&&(o=this.velocity[1],i=this.velocity[0]);let a,r;a=this.actions.moveRight?"right":this.actions.moveLeft?"left":"neutral",r=(this.actions.moveDown||this.playerAttributes.canMoveDown)&&0!==i&&!(this.actions.moveUp&&this.jumpFrames<this.maxJumpFrames)?"down":this.actions.moveUp?"up":"neutral",this.currentRep=this.cycleRep(this.cellRep[a][r])||this.currentRep}collisionDetection(){let t=this,[e,o]=t.location;this.playerAttributes.isHarmed=!1,this.playerAttributes.canMoveUp=!1,this.playerAttributes.canMoveDown=!1,this.playerAttributes.canMoveLeft=!1,this.playerAttributes.canMoveRight=!1,this.actions.autoRight=!1,this.actions.autoLeft=!1,this.actions.autoUp=!1,this.actions.autoDown=!1,this.climbing=!1;let i=!1;if(platformer.settings.collideWithCanvas){let a=function(t,e){return!!t.type&&(Array.isArray(e)?e.some(e=>t.type.includes(e)):t.type.includes(e))},r=!1,l=[t.location[0]+positionX,t.location[1]+positionY];if(help.getSquarePositions(l,0,1,platformer.settings.debug,function(t,e){let o=help.getCharInfo(e);!0!==o.empty&&(r=!0)}),r){let n=t.location[0]+positionX,s=t.location[1]+positionY;[n,s]=help.cellToPixel(help.pixelToCell([n,s])),n+=cellW/2,s+=cellH/2;let h=platformer.getCanvasArea(owotCtx,n-cellW,s-cellH,2*cellW,2*cellH),c=platformer.getSectionData(h,0,0,1,1),p=platformer.getSectionData(h,0,cellH,cellW,cellH),u=platformer.getSectionData(h,0,1,2,cellH),d=platformer.getSectionData(h,cellW+1,1,2,cellH),f=platformer.getSectionData(h,0,0,cellW+2,cellH+2),y={top:platformer.getCanvasAreaData(t,c,"top"),bottom:platformer.getCanvasAreaData(t,p,"bottom"),left:platformer.getCanvasAreaData(t,u,"left"),right:platformer.getCanvasAreaData(t,d,"right"),center:platformer.getCanvasAreaData(t,f,"center")};if(!(y.right.info||y.left.info||y.top.info||y.bottom.info||y.center.info))return;i=y.right.info.json||y.left.info.json||y.top.info.json||y.bottom.info.json||y.center.info.json,(y.top.empty||a(y.top,["ignore","jumpthrough","though_updown"]))&&(t.playerAttributes.canMoveUp=!0),(y.bottom.empty||a(y.bottom,["ignore","fallthough","though_updown"]))&&(t.playerAttributes.canMoveDown=!0),(y.left.empty||a(y.left,["ignore","leftthough","though_leftright"]))&&(t.playerAttributes.canMoveLeft=!0),(y.right.empty||a(y.right,["ignore","rightthough","though_leftright"]))&&(t.playerAttributes.canMoveRight=!0),y.center.empty||a(y.center,["ignore","jumpthrough","fallthough","though_updown","leftthough","rightthough","though_leftright"])?(t.playerAttributes.goodspot=!0,t.playerAttributes.lastGoodSpot=this.location):this.location=help.lerp(this.location,t.playerAttributes.lastGoodSpot,.1);let g=function(){return!1==y.center.empty||!1==y.bottom.empty||!1==y.top.empty||!1==y.left.empty||!1==y.right.empty},m=function(t){return a(y.bottom,[t])||a(y.top,[t])||a(y.left,[t])||a(y.right,[t])||a(y.center,[t])};g()&&m("autoRight")&&(this.actions.autoRight=!0),g()&&m("autoLeft")&&(this.actions.autoLeft=!0),g()&&m("autoUp")&&(this.actions.autoUp=!0),g()&&m("autoDown")&&(this.actions.autoDown=!0),g()&&m("climb")&&(this.climbing=!0)}else this.playerAttributes.canMoveUp=!0,this.playerAttributes.canMoveDown=!0,this.playerAttributes.canMoveLeft=!0,this.playerAttributes.canMoveRight=!0;i&&w.emit("handleJSON",i)}else this.playerAttributes.canMoveUp=!0,this.playerAttributes.canMoveDown=!0,this.playerAttributes.canMoveLeft=!0,this.playerAttributes.canMoveRight=!0}}};function snap(){let[t,e,o,i]=getTileCoordsFromMouseCoords(0,0),[a,r]=tileAndCharsToWindowCoords(t,e,o,i);positionX-=a,positionY-=r,w.redraw()}function collisionDetection(){for(let t of platformer.data.players)t.collisionDetection();gameSequence.stepUp()}function update(){for(let t of platformer.data.players)t.update();platformer.data.frame++,gameSequence.stepUp()}function cleanUp(){for(let t of platformer.data.layers)t.clear();gameSequence.stepUp()}function render(){setTimeout(function(){gameSequence.stepUp()},10)}const gameSequence=new help.automation.Sequencer("gameSequence"),stepCollisionDetection=gameSequence.createStep(collisionDetection),stepUpdate=gameSequence.createStep(update),stepCleanUp=gameSequence.createStep(cleanUp),stepRender=gameSequence.createStep(render);w.on("frame",function(){player.render()}),w.on("handleJSON",function(t){if(t.draw)for(let e of t.draw){let[o,i,a,r,l,n,s]=e;help.localwriteCharTo(o,i,a,r,l,n,s);let h={Btype:"local-write",Bdata:t.draw,Bname:name};w.broadcastCommand(`{"broadcast": {"${help.broadcast.channel}":${JSON.stringify(h)}}}`,!0)}t.alert&&!win&&(win=!0,alert(t.alert),location.reload())}),w.on("resize",function(){alert("resize not allowed right now"),location.reload()});let win=!1;w.setFlushInterval(0),gameSequence.sequenceLoop();class CanvasLayer{constructor(t){this.elm=owot.cloneNode(!0),this.elm.id=t,this.ctx=this.elm.getContext("2d"),elm.main_view.appendChild(this.elm),platformer.data.layers.push(this),this.elm.style.top=0,this.elm.style.position="fixed",this.elm.style.zIndex=1e3+platformer.data.layers.length,this.elm.style.pointerEvents="none"}clear(){this.ctx.clearRect(0,0,this.elm.width,this.elm.height)}drawRectangle(t,e,o){let[i,a]=platformer.settings.gravity;this.ctx.fillStyle=o,Math.abs(i)>Math.abs(a)?this.ctx.fillRect(t,e-cellH/4,cellH,cellW):this.ctx.fillRect(t,e-cellH/4,cellW,cellH)}drawTextCharacter(t,e,o,i){this.ctx.fillStyle=i,this.ctx.font=font,this.ctx.textBaseline="top",this.ctx.fillText(t,e,o)}}help.AutoUpdateName(),platformer.ReadFrequently(),w.disableScrolling(),w.disableDragging(),positionX=0,positionY=0,snap();const playerLayer=new CanvasLayer("playerLayer");(player=new platformer.Player(help.cellToPixel([0,0,2,7]))).layer=playerLayer,help.broadcast.cast=!0,help.broadcast.recieve(!0),help.broadcast.channel="demo-game",player.cellRep={right:{down:`ጄ`,up:`ዾ`,neutral:`ዱዳ`},left:{down:`ጆ`,up:`ጶ`,neutral:`ይያ`},neutral:{down:`ጀ`,up:`ጰ`,neutral:`ቶ`}},w.disableCursor(),fd=document.createElement("div"),menu.addEntry(fd),sd=new Date,af=0,glo=t=>{cd=new Date,++af,cd-sd>1e3&&(sd=cd,rf(af),af=0),requestAnimationFrame(glo)},rf=t=>{fd.innerHTML=`<h1>FPS: ${t}</h1>`},glo();
